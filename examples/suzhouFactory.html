<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>苏州工业园区部分道路动态展示</title>
  <link rel="stylesheet" href="https://unpkg.com/hmap-js@1.5.0/dist/hmap.css">
  <style>
    html, body, #map {
      height: 100%;
      padding: 0;
      margin: 0;
    }
    .hmap-control-zoom {
      right: 30px;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/hmap-js@1.5.0/dist/hmap.js"></script>
<script src="https://unpkg.com/jquery@3.2.1/dist/jquery.js"></script>
<script src="https://unpkg.com/echarts@3.7.1/dist/echarts.js"></script>
<script src="https://unpkg.com/ol3-echarts@1.2.0/dist/ol3Echarts.js"></script>
<script>
  document.onreadystatechange = function () {
    if (document.readyState === 'complete') {
      var Maps = new HMap('map', {
        controls: {
          loading: true,
          zoomSlider: true,
          fullScreen: false
        },
        view: {
          center: [13441825.420318395, 3676540.390477481],
          extent: [-2.0037507067161843E7, -3.0240971958386254E7, 2.0037507067161843E7, 3.0240971958386205E7],
          projection: 'EPSG:102100',
          tileSize: 256,
          zoom: 12, // resolution
        },
        baseLayers: [
          {
            layerName: 'vector',
            isDefault: true,
            layerType: 'TileXYZ',
            tileGrid: {
              tileSize: 256,
              extent: [-2.0037507067161843E7, -3.0240971958386254E7, 2.0037507067161843E7, 3.0240971958386205E7],
              origin: [-2.0037508342787E7, 2.0037508342787E7],
              resolutions: [
                156543.03392800014,
                78271.51696399994,
                39135.75848200009,
                19567.87924099992,
                9783.93962049996,
                4891.96981024998,
                2445.98490512499,
                1222.992452562495,
                611.4962262813797,
                305.74811314055756,
                152.87405657041106,
                76.43702828507324,
                38.21851414253662,
                19.10925707126831,
                9.554628535634155,
                4.77731426794937,
                2.388657133974685
              ]
            },
            layerUrl: 'http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}'
          }
        ]
      });
      $.get('https://www.easy-mock.com/mock/593e9f628ac26d795fea412c/ol3Echarts/roadData', function (res) {
        var busLines = [];
        var data = res.data;
        var hStep = 300 / (data.length - 1);
        var i = 0;
        for (var x in data) {
          var line = data[x];
          var pointString = line.ROAD_LINE;
          var pointArr = pointString.split(';');
          var lnglats = [];
          for (var j in pointArr) {
            var _coords = pointArr[j].split(',')
            lnglats.push(_coords)
          }
          busLines.push({
            coords: lnglats,
            lineStyle: {
              normal: {
                color: echarts.color.modifyHSL('#5A94DF', Math.round(hStep * x))
              }
            }
          })
        }
        var options = {
          openlayers: {},
          series: [
            {
              type: 'lines',
              coordinateSystem: 'openlayers',
              polyline: true,
              data: busLines,
              silent: false,
              lineStyle: {
                normal: {
                  // color: '#c23531',
                  // color: 'rgb(200, 35, 45)',
                  opacity: 0.2,
                  width: 1
                }
              },
              progressiveThreshold: 500,
              progressive: 200
            },
            {
              type: 'lines',
              coordinateSystem: 'openlayers',
              polyline: true,
              data: busLines,
              animation: false,
              lineStyle: {
                normal: {
                  width: 0
                }
              },
              effect: {
                constantSpeed: 20,
                show: true,
                trailLength: 0.1,
                symbolSize: 1.5
              },
              zlevel: 1
            }]
        }
        if (echartslayer !== undefined)
          return;
        var echartslayer = new ol3Echarts(Maps.map, {
          target: '.ol-overlaycontainer',
          source: '',
          destination: ''
        });
        echartslayer.chart.setOption(options);
      })
    }
  }
</script>
</body>
</html>
