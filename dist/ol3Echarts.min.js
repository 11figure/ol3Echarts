/*!
 * ol3-echarts v1.3.0
 * LICENSE : MIT
 * (c) 2017-2017 https://sakitam-fdd.github.io/ol3Echarts
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("openlayers"),require("echarts")):"function"==typeof define&&define.amd?define(["openlayers","echarts"],e):t.ol3Echarts=e(t.ol,t.echarts)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=(function(){function t(t){this.value=t}function e(e){function n(i,r){try{var s=e[i](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(s.done?"return":"normal",s.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?n(i.key,i.arg):r=null}var i,r;this._invoke=function(t,e){return new Promise(function(o,s){var a={key:t,arg:e,resolve:o,reject:s,next:null};r?r=r.next=a:(i=r=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),i=function(t){var e=void 0===t?"undefined":n(t);return null!==t&&("object"===e||"function"===e)},r=function(t){return function(){var e=void 0;return document&&/^#([\w-]+)$/.test(t)?(e=document.getElementById(RegExp.$1))?[e]:[]:Array.prototype.slice.call(/^\.([\w-]+)$/.test(t)?document.getElementsByClassName(RegExp.$1):/^[\w-]+$/.test(t)?document.getElementsByTagName(t):document.querySelectorAll(t))}()},s={hideOnZooming:!1,hideOnMoving:!1,hideOnRotating:!1},a=function(){function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.$options=Object.assign({},s,e),this.$chartOptions=t,this.$chart=null,this.$Map=null,this._isRegistered=!1}return n.prototype.appendTo=function(e){if(!(e&&e instanceof t.Map))throw new Error("not map object");this.$Map=e,this.render(),this._unRegisterEvents(),this._registerEvents()},n.prototype.getChartOptions=function(){return this.$chartOptions},n.prototype.setChartOptions=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.$chartOptions=t,this._clearAndRedraw(),this},n.prototype.getMap=function(){return this.$Map},n.prototype._isVisible=function(){return this.$container&&""===this.$container.style.display},n.prototype.show=function(){this.$container&&(this.$container.style.display="")},n.prototype.hide=function(){this.$container&&(this.$container.style.display="none")},n.prototype.remove=function(){this.$chart.clear(),this.$chart.dispose(),this._unRegisterEvents(),delete this.$chart,delete this.$Map,this.$container.parentNode.removeChild(this.$container)},n.prototype.clear=function(){this.$chart.clear()},n.prototype._createLayerContainer=function(t,e){var n=this.$container=document.createElement("div");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.right=0,n.style.buttom=0;var o=r(e.target);o&&o[0]&&o[0]instanceof Element?o[0].appendChild(n):t.getViewport().appendChild(n)},n.prototype._resizeContainer=function(){var t=this.getMap().getSize();this.$container.style.height=t[1]+"px",this.$container.style.width=t[0]+"px"},n.prototype._clearAndRedraw=function(){this.$container&&"none"===this.$container.style.display||(this.$chart.clear(),this.$chart.resize(),this.$chartOptions&&(this._registerMap(),this.$chart.setOption(this.$chartOptions,!1)))},n.prototype.onResize=function(){this._resizeContainer(),this._clearAndRedraw()},n.prototype.onZoomEnd=function(){this.show(),this._clearAndRedraw()},n.prototype.onDragRotateEnd=function(){this.show(),this._clearAndRedraw()},n.prototype.onMoveStart=function(){this.$options.hideOnMoving&&this.hide()},n.prototype.onMoveEnd=function(){this.show(),this._clearAndRedraw()},n.prototype._registerEvents=function(){var t=this.$Map,e=t.getView();t.on("change:size",this.onResize,this),e.on("change:resolution",this.onZoomEnd,this),e.on("change:center",this.onMoveEnd,this),e.on("change:rotation",this.onDragRotateEnd,this),t.on("movestart",this.onMoveStart,this),t.on("moveend",this.onMoveEnd,this)},n.prototype._unRegisterEvents=function(){var t=this.$Map,e=t.getView();t.un("change:size",this.onResize,this),e.un("change:resolution",this.onZoomEnd,this),e.un("change:center",this.onMoveEnd,this),e.un("change:rotation",this.onDragRotateEnd,this),t.un("movestart",this.onMoveStart,this),t.un("moveend",this.onMoveEnd,this)},n.prototype._registerMap=function(){this._isRegistered||(e.registerCoordinateSystem("openlayers",function(n,o){var i=function(){this.$options=o,this.$Map=n,this._mapOffset=[0,0],this.dimensions=["lng","lat"],this.projCode_=this._getProjectionCode()};return i.prototype.setMapOffset=function(t){this._mapOffset=t},i.prototype.dataToPoint=function(e){e&&Array.isArray(e)&&e.length>0&&(e=e.map(function(t){return"string"==typeof t&&(t=Number(t)),t}));var n=this.$options.source||"EPSG:4326",o=this.$options.destination||this.projCode_;return this.$Map.getPixelFromCoordinate(t.proj.transform(e,n,o))},i.prototype._getProjectionCode=function(){return this.$Map?this.$Map.getView()&&this.$Map.getView().getProjection().getCode():"EPSG:3857"},i.prototype.pointToData=function(t){return this.$Map.getCoordinateFromPixel(t)},i.prototype.getViewRect=function(){var t=this.$Map.getSize();return new e.graphic.BoundingRect(0,0,t[0],t[1])},i.prototype.getRoamTransform=function(){return e.matrix.create()},i.dimensions=["lng","lat"],i.getDimensionsInfo=function(){return i.dimensions},i.create=function(t){var e=this;t.eachSeries(function(t){"openlayers"===t.get("coordinateSystem")&&(t.coordinateSystem=new i(e.$Map))})},i}(this.getMap(),this.$options)),this._isRegistered=!0);var n=this.$chartOptions.series;if(n)for(var o=n.length-1;o>=0;o--)n[o].coordinateSystem="openlayers",n[o].animation=!1},n.prototype.render=function(){this.$container||(this._createLayerContainer(this.$Map,this.$options),this._resizeContainer()),this.$chart?this._isVisible()&&this.$chart.resize():(this.$chart=e.init(this.$container),this.$chartOptions&&(this._registerMap(),this.$chart.setOption(this.$chartOptions,!1)))},n}();return a.getTarget=r,a.merge=function t(e,n){for(var o in n)e.hasOwnProperty(o)?i(n[o])&&i(e[o])&&t(e[o],n[o]):e[o]=n[o];return e},a});