{"version":3,"file":"ol3Echarts.js","sources":["../src/helper.js","../src/coordinate/RegisterCoordinateSystem.js","../src/charts/pie.js","../src/charts/bar.js","../src/index.js"],"sourcesContent":["/**\r\n * Created by FDD on 2017/11/28.\r\n * @desc helper\r\n */\r\n\r\n/**\r\n * 判断是否为对象\r\n * @param value\r\n * @returns {boolean}\r\n */\r\nconst isObject = value => {\r\n  const type = typeof value\r\n  return value !== null && (type === 'object' || type === 'function')\r\n}\r\n\r\n/**\r\n * merge\r\n * @param a\r\n * @param b\r\n * @returns {*}\r\n */\r\nconst merge = (a, b) => {\r\n  for (const key in b) {\r\n    if (isObject(b[key]) && isObject(a[key])) {\r\n      merge(a[key], b[key])\r\n    } else {\r\n      a[key] = b[key]\r\n    }\r\n  }\r\n  return a\r\n}\r\n\r\n/**\r\n * get parent container\r\n * @param selector\r\n */\r\nconst getTarget = (selector) => {\r\n  let dom = (function () {\r\n    let found\r\n    return (document && /^#([\\w-]+)$/.test(selector))\r\n      ? ((found = document.getElementById(RegExp.$1)) ? [found] : [])\r\n      : Array.prototype.slice.call(/^\\.([\\w-]+)$/.test(selector)\r\n        ? document.getElementsByClassName(RegExp.$1)\r\n        : /^[\\w-]+$/.test(selector) ? document.getElementsByTagName(selector)\r\n          : document.querySelectorAll(selector)\r\n      )\r\n  })()\r\n  return dom\r\n}\r\n\r\n/**\r\n * 数组映射\r\n * @param {Array} obj\r\n * @param {Function} cb\r\n * @param {*} [context]\r\n * @return {Array}\r\n */\r\nconst map = function (obj, cb, context) {\r\n  if (!(obj && cb)) {\r\n    return\r\n  }\r\n  if (obj.map && obj.map === Array.prototype.map) {\r\n    return obj.map(cb, context)\r\n  } else {\r\n    let result = []\r\n    for (let i = 0, len = obj.length; i < len; i++) {\r\n      result.push(cb.call(context, obj[i], i, obj))\r\n    }\r\n    return result\r\n  }\r\n}\r\n\r\nconst bind = function (func, context) {\r\n  let args = Array.prototype.slice.call(arguments, 2)\r\n  return function () {\r\n    return func.apply(context, args.concat(Array.prototype.slice.call(arguments)))\r\n  }\r\n}\r\n\r\nexport {\r\n  getTarget,\r\n  merge,\r\n  isObject,\r\n  map,\r\n  bind\r\n}\r\n","/**\r\n * Created by FDD on 2017/5/30.\r\n * @desc 坐标系统\r\n */\r\n\r\nimport echarts from 'echarts'\r\nimport ol from 'openlayers'\r\nimport { map as $map, bind } from '../helper'\r\n\r\nconst _getCoordinateSystem = function (map, options = {}) {\r\n  const RegisterCoordinateSystem = function () {\r\n    this._mapOffset = [0, 0]\r\n    this.dimensions = ['lng', 'lat']\r\n    this.projCode_ = this._getProjectionCode()\r\n  }\r\n\r\n  RegisterCoordinateSystem.prototype.dimensions = ['lng', 'lat']\r\n\r\n  RegisterCoordinateSystem.dimensions = RegisterCoordinateSystem.prototype.dimensions\r\n\r\n  /**\r\n   * 设置地图窗口的偏移\r\n   * @param mapOffset\r\n   */\r\n  RegisterCoordinateSystem.prototype.setMapOffset = function (mapOffset) {\r\n    this._mapOffset = mapOffset\r\n  }\r\n\r\n  /**\r\n   * 跟据坐标转换成屏幕像素\r\n   * @param coords\r\n   * @returns {ol.Pixel}\r\n   */\r\n  RegisterCoordinateSystem.prototype.dataToPoint = function (coords) {\r\n    if (coords && Array.isArray(coords) && coords.length > 0) {\r\n      coords = coords.map(function (item) {\r\n        if (typeof item === 'string') {\r\n          item = Number(item)\r\n        }\r\n        return item\r\n      })\r\n    }\r\n    let source = options['source'] || 'EPSG:4326'\r\n    let destination = options['destination'] || this.projCode_\r\n    let pixel = map.getPixelFromCoordinate(ol.proj.transform(coords, source, destination))\r\n    const mapOffset = this._mapOffset\r\n    return [pixel[0] - mapOffset[0], pixel[1] - mapOffset[1]]\r\n  }\r\n\r\n  /**\r\n   * 获取地图视图投影\r\n   * @returns {string}\r\n   * @private\r\n   */\r\n  RegisterCoordinateSystem.prototype._getProjectionCode = function () {\r\n    let code = ''\r\n    if (map) {\r\n      code = map.getView() && map.getView().getProjection().getCode()\r\n    } else {\r\n      code = 'EPSG:3857'\r\n    }\r\n    return code\r\n  }\r\n\r\n  /**\r\n   * 跟据屏幕像素转换成坐标\r\n   * @param pixel\r\n   * @returns {ol.Coordinate}\r\n   */\r\n  RegisterCoordinateSystem.prototype.pointToData = function (pixel) {\r\n    const mapOffset = this._mapOffset\r\n    return map.getCoordinateFromPixel([pixel[0] + mapOffset[0], pixel[1] + mapOffset[1]])\r\n  }\r\n\r\n  /**\r\n   * 获取视图矩形范围\r\n   * @returns {*}\r\n   */\r\n  RegisterCoordinateSystem.prototype.getViewRect = function () {\r\n    const size = map.getSize()\r\n    return new echarts.graphic.BoundingRect(0, 0, size[0], size[1])\r\n  }\r\n\r\n  /**\r\n   * 移动转换\r\n   */\r\n  RegisterCoordinateSystem.prototype.getRoamTransform = function () {\r\n    return echarts.matrix.create()\r\n  }\r\n\r\n  /**\r\n   * 处理自定义图表类型\r\n   * @param data\r\n   * @returns {{coordSys: {type: string, x, y, width, height}, api: {coord, size}}}\r\n   */\r\n  RegisterCoordinateSystem.prototype.prepareCustoms = function (data) {\r\n    const rect = this.getViewRect()\r\n    return {\r\n      coordSys: {\r\n        // The name exposed to user is always 'cartesian2d' but not 'grid'.\r\n        type: 'openlayers',\r\n        x: rect.x,\r\n        y: rect.y,\r\n        width: rect.width,\r\n        height: rect.height\r\n      },\r\n      api: {\r\n        coord: bind(this.dataToPoint, this),\r\n        size: bind(RegisterCoordinateSystem.dataToCoordSize, this)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * math coord size\r\n   * @param dataSize\r\n   * @param dataItem\r\n   */\r\n  RegisterCoordinateSystem.dataToCoordSize = function (dataSize, dataItem) {\r\n    dataItem = dataItem || [0, 0]\r\n    return $map([0, 1], function (dimIdx) {\r\n      let val = dataItem[dimIdx]\r\n      let halfSize = dataSize[dimIdx] / 2\r\n      let [p1, p2] = [[], []]\r\n      p1[dimIdx] = val - halfSize\r\n      p2[dimIdx] = val + halfSize\r\n      p1[1 - dimIdx] = p2[1 - dimIdx] = dataItem[1 - dimIdx]\r\n      return Math.abs(this.dataToPoint(p1)[dimIdx] - this.dataToPoint(p2)[dimIdx])\r\n    }, this)\r\n  }\r\n\r\n  /**\r\n   * 注册实例\r\n   * @param echartModel\r\n   */\r\n  RegisterCoordinateSystem.create = function (echartModel, api) {\r\n    echartModel.eachSeries(function (seriesModel) {\r\n      if (seriesModel.get('coordinateSystem') === 'openlayers') {\r\n        seriesModel.coordinateSystem = new RegisterCoordinateSystem(map)\r\n      }\r\n    })\r\n  }\r\n\r\n  return RegisterCoordinateSystem\r\n}\r\n\r\nexport default _getCoordinateSystem\r\n","const pie = function (options, serie, coordinateSystem) {\r\n  serie.center = coordinateSystem.dataToPoint(serie.coordinates)\r\n  return serie\r\n}\r\n\r\nexport default pie\r\n","import { isObject } from '../helper'\r\n\r\nconst bar = function (options, serie, coordinateSystem) {\r\n  if (isObject(options.grid) && !Array.isArray(options.grid)) {\r\n    console.log(options)\r\n  } else if (Array.isArray(options.grid)) {\r\n    options.grid = options.grid.map(function (gri, index) {\r\n      let coorPixel = coordinateSystem.dataToPoint(options.series[index].coordinates)\r\n      gri.left = coorPixel[0] - parseFloat(gri.width) / 2\r\n      gri.top = coorPixel[1] - parseFloat(gri.height) / 2\r\n      return gri\r\n    })\r\n  }\r\n  return serie\r\n}\r\n\r\nexport default bar\r\n","import ol from 'openlayers'\r\nimport echarts from 'echarts'\r\nimport { getTarget, merge, isObject, map, bind } from './helper'\r\nimport _getCoordinateSystem from './coordinate/RegisterCoordinateSystem'\r\nimport * as charts from './charts/index'\r\n// FIXME 地图相关事件的polyfill（事件触发的开始结束），参数定义（包含重绘，动画等）\r\nconst _options = {\r\n  forcedRerender: false, // Force re-rendering\r\n  hideOnZooming: false, // when zooming hide chart\r\n  hideOnMoving: false, // when moving hide chart\r\n  hideOnRotating: false, // // when Rotating hide chart\r\n  convertTypes: ['pie', 'line', 'bar']\r\n}\r\n\r\nclass ol3Echarts {\r\n  static getTarget = getTarget\r\n  static merge = merge\r\n  static map = map\r\n  static bind = bind\r\n  constructor (chartOptions, options = {}, map) {\r\n    /**\r\n     * layer options\r\n     * @type {{}}\r\n     */\r\n    this.$options = merge(_options, options)\r\n\r\n    /**\r\n     * chart options\r\n     */\r\n    this.$chartOptions = chartOptions\r\n\r\n    /**\r\n     * chart instance\r\n     * @type {null}\r\n     */\r\n    this.$chart = null\r\n\r\n    /**\r\n     * map\r\n     * @type {null}\r\n     */\r\n    this.$Map = null\r\n\r\n    /**\r\n     * Whether the relevant configuration has been registered\r\n     * @type {boolean}\r\n     * @private\r\n     */\r\n    this._isRegistered = false\r\n\r\n    /**\r\n     * coordinate system\r\n     * @type {null}\r\n     * @private\r\n     */\r\n    this._coordinateSystem = null\r\n\r\n    if (map) this.appendTo(map)\r\n  }\r\n\r\n  /**\r\n   * append layer to map\r\n   * @param map\r\n   */\r\n  appendTo (map) {\r\n    if (map && map instanceof ol.Map) {\r\n      this.$Map = map\r\n      this.$Map.once('postrender', this.render, this)\r\n      this.$Map.renderSync()\r\n      this._unRegisterEvents()\r\n      this._registerEvents()\r\n    } else {\r\n      throw new Error('not map object')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get echarts options\r\n   * @returns {*}\r\n   */\r\n  getChartOptions () {\r\n    return this.$chartOptions\r\n  }\r\n\r\n  /**\r\n   * set echarts options and reRender\r\n   * @param options\r\n   * @returns {ol3Echarts}\r\n   */\r\n  setChartOptions (options = {}) {\r\n    this.$chartOptions = options\r\n    this.$Map.once('postrender', this.render, this)\r\n    this.$Map.renderSync()\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * get map\r\n   * @returns {null}\r\n   */\r\n  getMap () {\r\n    return this.$Map\r\n  }\r\n\r\n  /**\r\n   * is visible\r\n   * @returns {Element|*|boolean}\r\n   * @private\r\n   */\r\n  _isVisible () {\r\n    return this.$container && this.$container.style.display === ''\r\n  }\r\n\r\n  /**\r\n   * show layer\r\n   */\r\n  show () {\r\n    if (this.$container) {\r\n      this.$container.style.display = ''\r\n    }\r\n  }\r\n\r\n  /**\r\n   * hide layer\r\n   */\r\n  hide () {\r\n    if (this.$container) {\r\n      this.$container.style.display = 'none'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * remove layer\r\n   */\r\n  remove () {\r\n    this.$chart.clear()\r\n    this.$chart.dispose()\r\n    this._unRegisterEvents()\r\n    delete this.$chart\r\n    delete this.$Map\r\n    this.$container.parentNode.removeChild(this.$container)\r\n  }\r\n\r\n  /**\r\n   * clear chart\r\n   */\r\n  clear () {\r\n    this.$chart.clear()\r\n  }\r\n\r\n  /**\r\n   * show loading bar\r\n   */\r\n  showLoading () {\r\n    if (this.$chart) {\r\n      this.$chart.showLoading()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * hide loading bar\r\n   */\r\n  hideLoading () {\r\n    if (this.$chart) {\r\n      this.$chart.hideLoading()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * creat eclayer container\r\n   * @param map\r\n   * @param options\r\n   * @private\r\n   */\r\n  _createLayerContainer (map, options) {\r\n    const container = this.$container = document.createElement('div')\r\n    container.style.position = 'absolute'\r\n    container.style.top = 0\r\n    container.style.left = 0\r\n    container.style.right = 0\r\n    container.style.bottom = 0\r\n    let _target = getTarget(options['target'])\r\n    if (_target && _target[0] && _target[0] instanceof Element) {\r\n      _target[0].appendChild(container)\r\n    } else {\r\n      let _target = getTarget('.ol-overlaycontainer')\r\n      if (_target && _target[0] && _target[0] instanceof Element) {\r\n        _target[0].appendChild(container)\r\n      } else {\r\n        map.getViewport().appendChild(container)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset the container size\r\n   * @private\r\n   */\r\n  _resizeContainer () {\r\n    const size = this.getMap().getSize()\r\n    this.$container.style.height = size[1] + 'px'\r\n    this.$container.style.width = size[0] + 'px'\r\n  }\r\n\r\n  /**\r\n   * clear chart and redraw\r\n   * @private\r\n   */\r\n  _clearAndRedraw () {\r\n    if (!this.$chart || (this.$container && this.$container.style.display === 'none')) {\r\n      return\r\n    }\r\n    if (this.$options.forcedRerender) {\r\n      this.$chart.clear()\r\n    }\r\n    this.$chart.resize()\r\n    if (this.$chartOptions) {\r\n      this._registerMap()\r\n      this.$chart.setOption(this.reConverData(this.$chartOptions), false)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * handle map resize\r\n   */\r\n  onResize () {\r\n    this._resizeContainer()\r\n    this._clearAndRedraw()\r\n  }\r\n\r\n  /**\r\n   * handle zoom end events\r\n   */\r\n  onZoomEnd () {\r\n    if (!this.$options['hideOnZooming']) {\r\n      return\r\n    }\r\n    this.show()\r\n    this._clearAndRedraw()\r\n  }\r\n\r\n  /**\r\n   * handle rotate end events\r\n   */\r\n  onDragRotateEnd () {\r\n    if (!this.$options['hideOnRotating']) {\r\n      return\r\n    }\r\n    this.show()\r\n    this._clearAndRedraw()\r\n  }\r\n\r\n  /**\r\n   * handle move start events\r\n   */\r\n  onMoveStart () {\r\n    if (this.$options['hideOnMoving']) {\r\n      this.hide()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * handle move end events\r\n   */\r\n  onMoveEnd () {\r\n    if (!this.$options['hideOnMoving']) {\r\n      return\r\n    }\r\n    this.show()\r\n    this._clearAndRedraw()\r\n  }\r\n\r\n  onCenterChange () {\r\n    //\r\n  }\r\n\r\n  /**\r\n   * register events\r\n   * @private\r\n   */\r\n  _registerEvents () {\r\n    const Map = this.$Map\r\n    const view = Map.getView()\r\n    Map.on('precompose', this.reRender, this)\r\n    Map.on('change:size', this.onResize, this)\r\n    view.on('change:resolution', this.onZoomEnd, this)\r\n    view.on('change:center', this.onCenterChange, this)\r\n    view.on('change:rotation', this.onDragRotateEnd, this)\r\n    Map.on('movestart', this.onMoveStart, this)\r\n    Map.on('moveend', this.onMoveEnd, this)\r\n  }\r\n\r\n  /**\r\n   * un register events\r\n   * @private\r\n   */\r\n  _unRegisterEvents () {\r\n    const Map = this.$Map\r\n    const view = Map.getView()\r\n    Map.un('change:size', this.onResize, this)\r\n    Map.un('precompose', this.reRender, this)\r\n    view.un('change:resolution', this.onZoomEnd, this)\r\n    view.un('change:center', this.onCenterChange, this)\r\n    view.un('change:rotation', this.onDragRotateEnd, this)\r\n    Map.un('movestart', this.onMoveStart, this)\r\n    Map.un('moveend', this.onMoveEnd, this)\r\n  }\r\n\r\n  /**\r\n   * register map coordinate system\r\n   * @private\r\n   */\r\n  _registerMap () {\r\n    if (!this._isRegistered) {\r\n      echarts.registerCoordinateSystem('openlayers', _getCoordinateSystem(this.getMap(), this.$options))\r\n      this._isRegistered = true\r\n    }\r\n    const series = this.$chartOptions.series\r\n    if (series && isObject(series)) {\r\n      for (let i = series.length - 1; i >= 0; i--) {\r\n        if (!(this.$options.convertTypes.indexOf(series[i]['type']) > -1)) {\r\n          series[i]['coordinateSystem'] = 'openlayers'\r\n        }\r\n        series[i]['animation'] = false\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重新处理数据\r\n   * @param options\r\n   * @returns {*}\r\n   */\r\n  reConverData (options) {\r\n    let series = options['series']\r\n    if (series && series.length > 0) {\r\n      if (!this._coordinateSystem) {\r\n        let _cs = _getCoordinateSystem(this.getMap(), this.$options)\r\n        this._coordinateSystem = new _cs()\r\n      }\r\n      if (series && isObject(series)) {\r\n        for (let i = series.length - 1; i >= 0; i--) {\r\n          if (this.$options.convertTypes.indexOf(series[i]['type']) > -1) {\r\n            if (series[i] && series[i].hasOwnProperty('coordinates')) {\r\n              series[i] = charts[series[i]['type']](options, series[i], this._coordinateSystem)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return options\r\n  }\r\n\r\n  /**\r\n   * render\r\n   */\r\n  render () {\r\n    if (!this.$container) {\r\n      this._createLayerContainer(this.$Map, this.$options)\r\n      this._resizeContainer()\r\n    }\r\n    if (!this.$chart) {\r\n      this.$chart = echarts.init(this.$container)\r\n      if (this.$chartOptions) {\r\n        this._registerMap()\r\n        this.$chart.setOption(this.reConverData(this.$chartOptions), false)\r\n      }\r\n    } else if (this._isVisible()) {\r\n      this.$chart.resize()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * re-render\r\n   */\r\n  reRender () {\r\n    this._clearAndRedraw()\r\n  }\r\n}\r\nexport default ol3Echarts\r\n"],"names":["isObject","type","value","merge","a","b","key","getTarget","selector","dom","found","document","test","getElementById","RegExp","$1","Array","prototype","slice","call","getElementsByClassName","getElementsByTagName","querySelectorAll","map","obj","cb","context","result","i","len","length","push","bind","func","args","arguments","apply","concat","_getCoordinateSystem","options","RegisterCoordinateSystem","_mapOffset","dimensions","projCode_","_getProjectionCode","setMapOffset","mapOffset","dataToPoint","coords","isArray","item","Number","source","destination","pixel","getPixelFromCoordinate","ol","proj","transform","code","getView","getProjection","getCode","pointToData","getCoordinateFromPixel","getViewRect","size","getSize","echarts","graphic","BoundingRect","getRoamTransform","matrix","create","prepareCustoms","data","rect","x","y","width","height","dataToCoordSize","dataSize","dataItem","$map","dimIdx","val","halfSize","p1","p2","Math","abs","echartModel","api","eachSeries","seriesModel","get","coordinateSystem","pie","serie","center","coordinates","bar","grid","log","gri","index","coorPixel","series","left","parseFloat","top","_options","ol3Echarts","chartOptions","$options","$chartOptions","$chart","$Map","_isRegistered","_coordinateSystem","appendTo","Map","once","render","renderSync","_unRegisterEvents","_registerEvents","Error","getChartOptions","setChartOptions","getMap","_isVisible","$container","style","display","show","hide","remove","clear","dispose","parentNode","removeChild","showLoading","hideLoading","_createLayerContainer","container","createElement","position","right","bottom","_target","Element","appendChild","getViewport","_resizeContainer","_clearAndRedraw","forcedRerender","resize","_registerMap","setOption","reConverData","onResize","onZoomEnd","onDragRotateEnd","onMoveStart","onMoveEnd","onCenterChange","view","on","reRender","un","registerCoordinateSystem","convertTypes","indexOf","_cs","hasOwnProperty","charts","init"],"mappings":"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"}